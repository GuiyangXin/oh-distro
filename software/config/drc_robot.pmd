group "0.dev_deputies" {
    cmd "robot_deputy" {
        exec = "bot-procman-deputy -n robot";
        host = "localhost";
    }
    cmd "base_deputy" {
        exec = "bot-procman-deputy -n base";
        host = "localhost";
    }
}

group "1.a.core" {
    cmd "pserver" {
        exec = "bot-param-server $HOME/drc/software/config/drc_robot.cfg";
        host = "robot";
    }
    cmd "roscore" {
        exec = "roscore";
        host = "robot";
    }
    cmd "viewer" {
        exec = "drc-viewer";
        host = "robot";
    }
    cmd "modelpub" {
        exec = "robot_model_publisher -u $HOME/drc/software/models/mit_gazebo_models/mit_robot_nohands/model.urdf";
        host = "robot";
    }
    cmd "estpub" {
        exec = "est_robot_state_publisher -g";
        host = "robot";
    }
    cmd "r2l_control" {
        exec = "rosrun translators ros2lcm -c -g";
        host = "robot";
    }
    cmd "l2r" {
        exec = "rosrun translators lcm2ros -p";
        host = "robot";
    }
    cmd "netshaper" {
        exec = "drc-network-shaper -t manipulation -r robot -c drc_robot.cfg";
        host = "robot";
    }
}

group "1.b.sensing" {
    cmd "j2f" {
        exec = "drc-joints2frames -g";
        host = "robot";
    }
    cmd "r2l_perception" {
        exec = "rosrun translators ros2lcm -p";
        host = "robot";
    }
    cmd "maps-server" {
        exec = "maps-server";
        host = "robot";
    }
    cmd "data-request-server" {
        exec = "data-request-server";
        host = "robot";
    }
    cmd "lidarfilt" {
        exec = "drc-lidar-passthrough";
        host = "robot";
    }
    cmd "icompress" {
        exec = "drc-image-tool";
        host = "robot";
    }
}

group "2.gazebo" {
    cmd "mit_manip" {
        exec = "roslaunch mit_drcsim_scripts mit.launch gzworld:=$HOME/drc/ros_workspace/mit_drcsim_scripts/worlds/mit_manip.world";
        host = "robot";
    }
    cmd "mit_manip_slow" {
        exec = "roslaunch mit_drcsim_scripts mit.launch gzworld:=$HOME/drc/ros_workspace/mit_drcsim_scripts/worlds/mit_manip_slow.world gzname:=run_gazebo_unpaused";
        host = "robot";
    }
    cmd "mit_ingress_slow" {
        exec = "roslaunch mit_drcsim_scripts mit.launch gzworld:=$HOME/drc/ros_workspace/mit_drcsim_scripts/worlds/mit_ingress_slow.world";
        host = "robot";
    }
    cmd "mit_walking_slow" {
        exec = "roslaunch mit_drcsim_scripts mit.launch gzworld:=$HOME/drc/ros_workspace/mit_drcsim_scripts/worlds/mit_walking.world";
        host = "robot";
    }
    cmd "mit_walking_bdi" {
        exec = "roslaunch mit_drcsim_scripts mit.launch gzworld:=$HOME/drc/ros_workspace/mit_drcsim_scripts/worlds/mit_walking_bdi.world gzname:=run_gazebo_unpaused";
        host = "robot";
    }
    cmd "mit_driving" {
        exec = "roslaunch mit_drcsim_scripts mit.launch gzworld:=$HOME/drc/ros_workspace/mit_drcsim_scripts/worlds/mit_driving.world";
        host = "robot";
    }
    cmd "qual_walking_slow" {
        exec = "roslaunch mit_drcsim_scripts mit.launch gzworld:=$HOME/drc/ros_workspace/mit_drcsim_scripts/worlds/qual_task_1.world";
        host = "robot";
    }
    cmd "qual_walking_slow_unpaused" {
        exec = "roslaunch mit_drcsim_scripts mit.launch gzworld:=$HOME/drc/ros_workspace/mit_drcsim_scripts/worlds/qual_task_1.world gzname:=run_gazebo_unpaused";
        host = "robot";
    }
    cmd "qual_walking_slow_steps" {
        exec = "roslaunch mit_drcsim_scripts mit.launch gzworld:=$HOME/drc/ros_workspace/mit_drcsim_scripts/worlds/qual_task_1_steps.world";
        host = "robot";
    }
    cmd "qual_manipulation" {
        exec = "roslaunch mit_drcsim_scripts mit.launch gzworld:=$HOME/drc/ros_workspace/mit_drcsim_scripts/worlds/qual_task_2.world";
        host = "robot";
    }
    cmd "qual_climbing" {
        exec = "roslaunch mit_drcsim_scripts mit.launch gzworld:=/usr/local/share/drcsim-2.3/worlds/qual_task_3.world";
        host = "robot";
    }
    cmd "qual_ladder" {
        exec = "roslaunch mit_drcsim_scripts mit.launch gzworld:=/usr/local/share/drcsim-2.3/worlds/qual_task_4.world";
        host = "robot";
    }
    cmd "vrc_driving" {
        exec = "roslaunch mit_drcsim_scripts mit.launch gzworld:=/usr/local/share/drcsim-2.3/worlds/vrc_task_1.world";
        host = "robot";
    }
    cmd "vrc_walking" {
        exec = "roslaunch mit_drcsim_scripts mit.launch gzworld:=/usr/local/share/drcsim-2.3/worlds/vrc_task_2.world";
        host = "robot";
    }
    cmd "vrc_manip" {
        exec = "roslaunch mit_drcsim_scripts mit.launch gzworld:=/usr/local/share/drcsim-2.3/worlds/vrc_task_3.world";
        host = "robot";
    }
}

group "3.perception"{
    cmd "aff_server" {
        exec = "affordance_server  -r robot";
        host = "robot";
    }
    cmd "estpub_sensing" {
        exec = "est_robot_state_publisher";
        host = "robot";
    }
    cmd "motion_vo" {
        exec = "drc-fovision-odometry -i 2";
        host = "robot";
    }
    cmd "stereo-bm" {
        exec = "stereo-bm";
        host = "robot";
    }
    cmd "imagemask" {
        exec = "drc-image-passthrough -o 1";
        host = "robot";
    }
    cmd "maskunzip" {
        exec = "drc-image-tool -m 1 -c CAMERALEFT_MASKZIPPED -d 1";
        host = "robot";
    }
}

group "3a.motion_vo"{
    cmd "motion_vo_testing" {
        exec = "drc-fovision-odometry -i 3";
        host = "robot";
    }
    cmd "estpub_sensing" {
        exec = "est_robot_state_publisher";
        host = "robot";
    }
}

group "4.drake_robot" {
    cmd "Qual1StateMachine" {
       exec = "matlab -nosplash -nodesktop -r \"cd([getenv('DRC_PATH'),'/control/matlab']); runQual1StateMachine;\"";
        host = "robot";
    }
    cmd "Qual2StateMachine" {
       exec = "matlab -nosplash -nodesktop -r \"cd([getenv('DRC_PATH'),'/control/matlab']); runQual2StateMachine;\"";
        host = "robot";
    }
    cmd "PrecomputationServer" {
       exec = "matlab -nosplash -nodesktop -r \"cd([getenv('DRC_PATH'),'/control/matlab']); runPrecomputeServer;\"";
        host = "robot";
    }
    cmd "ReachPlanFollower_PD" {
       exec = "matlab -nosplash -nodesktop -r \"cd([getenv('DRC_PATH'),'/control/matlab/pinned_manipulation']); runReachPlanFollowerLCMRobot;\"";
       host = "robot";
    }
    cmd "GraspController" {
       exec = "matlab -nosplash -nodesktop -r \"cd([getenv('DRC_PATH'),'/control/matlab/grasp_execution']); runSimpleGraspExecutionScript;\"";
       host = "robot";
    } 
    cmd "FootContactEstimator" {
       exec = "drc-legged-odometry";
        host = "robot";
    }
    cmd "KinematicFootContactEstimator" {
       exec = "matlab -nosplash -nodesktop -r \"cd([getenv('DRC_PATH'),'/control/matlab']); runKinematicFootContactEstimator;\"";
        host = "robot";
    }
}

group "5.base" {
    cmd "netshaper" {
        exec = "drc-network-shaper -t manipulation -r base -c drc_robot.cfg";
        host = "base";
    }
    cmd "base_viewer" {
        exec = "drc-viewer  -r base -c drc_robot.cfg"; 
        host = "base";
    }
    cmd "surrogate_viewer" {
        exec = "surrogate_viewer -r base";
        host = "base";
    }
    cmd "modelpub" {
        exec = "robot_model_publisher -r base -u $HOME/drc/software/models/mit_gazebo_models/mit_robot/model.urdf";
        host = "base";
    }
    cmd "aff_server" {
        exec = "affordance_server  -r base";
        host = "base";
    }
    cmd "j2f" {
        exec = "drc-joints2frames -r base";
        host = "base";
    }
    cmd "param_server" {
        exec = "bot-param-server $HOME/drc/software/config/drc_robot.cfg -l 'udpm://239.255.76.68:7668?ttl=0'";
        host = "base";
    }
    cmd "mini2maxi" {
        exec = "minimal_to_est_robot_state  -r base";
        host = "base";
    }
}

group "6.drake_base" {
    cmd "sticky_hands" {
       exec = "matlab -nosplash -nodesktop -r \" cd([getenv('DRC_PATH'),'/control/matlab/sticky_hands']); runGraspSynthesisPoolServer (4);\"";
       host = "base";
    }
    cmd "ReachingPlanner" {
       exec = "matlab -nosplash -nodesktop -r \" cd([getenv('DRC_PATH'),'/control/matlab/pinned_manipulation']); runPinnedReachPlanningLCMBase;\"";
       host = "base";
    }    
    cmd "FootstepPlanner" {
       exec = "matlab -nosplash -nodesktop -r \"cd([getenv('DRC_PATH'),'/control/matlab/footstep_planner']); runFootstepPlanner;\"";
        host = "base";
    }
    cmd "ZMPWalkingPlanner" {
       exec = "matlab -nosplash -nodesktop -r \"setenv('LCM_DEFAULT_URL','udpm://239.255.76.68:7668?ttl=0'); cd([getenv('DRC_PATH'),'/control/matlab']); runWalkingPlanner;\"";
        host = "base";
    }
}


group "robot.simple_control" {
    cmd "head_0" {
        exec = "rosrun tutorial_atlas_control traj_yaml.py $HOME/drc/ros_workspace/tutorial_atlas_control/scripts/Traj_data2.yaml  look_flat_hands_down";
        host = "robot";
    }
    cmd "head_45" {
        exec = "rosrun tutorial_atlas_control traj_yaml.py $HOME/drc/ros_workspace/tutorial_atlas_control/scripts/Traj_data2.yaml  look_part_down_hands_down";
        host = "robot";
    }
    cmd "head_90" {
        exec = "rosrun tutorial_atlas_control traj_yaml.py $HOME/drc/ros_workspace/tutorial_atlas_control/scripts/Traj_data2.yaml  look_full_down_hands_down";
        host = "robot";
    }
    cmd "hand_in_view" {
        exec = "rosrun tutorial_atlas_control traj_yaml.py $HOME/drc/ros_workspace/tutorial_atlas_control/scripts/Traj_data2.yaml  hand_in_view";
        host = "robot";
    }
    cmd "individual_joints" {
        exec = "rosrun tutorial_atlas_control traj_gui.py";
        host = "robot";
    }
}

group "robot.misc" {
    cmd "robot_spy" {
        exec = "bot-spy";
        host = "robot";
    }
    cmd "lcmscope" {
        exec = "drc-lcmscope";
        host = "robot";
    }
    cmd "teleop" {
        exec = "rosrun keyboard_teleop keyboard_teleop";
        host = "robot";
    }
    cmd "maskunzip" {
        exec = "drc-image-tool -m 1 -c CAMERALEFT_MASKZIPPED -d 1";
        host = "robot";
    }
    cmd "bandwidth-scope" {
        exec = "drc-bandwidth-scope";
        host = "robot";
    }
    cmd "sheriff_obs" {
        exec = "bot-procman-sheriff -o";
        host = "robot";
    }
}

group "7.driving" {
    cmd "exit_robot" {
        exec = "rostopic pub --once /drc_world/robot_exit_car geometry_msgs/Pose '{}'";
        host = "robot";
    }
    cmd "drc-lidar-classifier" {
        exec = "drc-lidar-classifier";
        host = "robot";
    }
    cmd "vehicle-groundtruth-state" {
        exec = "rosrun driving_interface groundtruth_receiver";
        host = "robot";
    }
    cmd "drc-car-quick-vis" {
        exec = "drc-car-quick-vis";
        host = "robot";
    }
    cmd "driving_interface" {
        exec = "rosrun driving_interface driving_interface";
        host = "robot";
    }
    cmd "send_affordance" {
        exec = "affordance_points_drill_send";
        host = "robot";
    }
    cmd "TLD-Tracker" {
        exec = "drc-driving-tracker";
        host = "robot";
    }
    cmd "TLD-Segmenter" {
        exec = "drc-tld-segmenter -c CAMERALEFT_COMPRESSED";
        host = "robot";
    }
    cmd "affordance_server -r robot" {
        exec = "affordance_server -r robot";
        host = "robot";
    }
    cmd "seat_robot" {
        exec = "rostopic pub --once /drc_world/robot_enter_car geometry_msgs/Pose '{}'";
        host = "robot";
    }
    cmd "drc-driving-control" {
        exec = "drc-driving-control";
        host = "robot";
    }
    cmd "drc-terrain-classifier" {
        exec = "drc-terrain-classifier -s";
        host = "robot";
    }
}


group "base.misc" {
    cmd "lcmscope" {
        exec = "drc-lcmscope";
        host = "base";
    }
    cmd "base_spy" {
        exec = "bot-spy -l 'udpm://239.255.76.68:7668?ttl=0'";
        host = "base";
    }
    cmd "bandwidth-scope" {
        exec = "drc-bandwidth-scope";
        host = "base";
    }
}
group "robot.dev_tools" {
    cmd "teleport_to_steps" {
        exec = "rostopic pub /atlas/set_pose geometry_msgs/Pose '[-3.5, 12.5, 1.55]' '[0, 0, 0, 1]'";
        host = "robot";
    }
    cmd "teleport_to_000" {
        exec = "rostopic pub /atlas/set_pose geometry_msgs/Pose '[0.0, 0.0, 1.00]' '[0, 0, 0, 1]'";
        host = "robot";
    }
    cmd "oracle2coll" {
        exec = "drc-oracle2collection";
        host = "robot";
    }
}

group "utils.system-test" {
    cmd "systemwide-test" {
        exec = "drc-systemwide-tests";
        host = "robot";
    }
    cmd "set-sim-rate" {
        exec = "drc-set-sim-rate 0.25";
        host = "robot";
    }
    cmd "lcm-logger-no-vis" {
        exec = "lcm-logger -c 'CAMERA|CAMERALEFT' -v";
        host = "robot";
    }
}

######################################
########### Walking ##################
script "core-start" {
    start group "0.dev_deputies";
    start group "1.a.core";
    wait ms 100;
    start group "1.b.sensing";
    start cmd "FootContactEstimator"; 
    start cmd "PrecomputationServer"; 
    start cmd "Qual1StateMachine";
    start cmd "FootstepPlanner";
    start cmd "ZMPWalkingPlanner";
    wait ms 10000;
}

script "core-start-mit-walking" {
    run_script "core-start";
    start cmd "mit_walking_slow";
    wait ms 4000;
    start cmd "set-sim-rate";
}

script "core-start-mit-manip" {
    run_script "core-start";
    start cmd "mit_manip_slow";
    wait ms 4000;
    start cmd "set-sim-rate";
}

script "run_QUAL_1" {
    run_script "core-start";
    start cmd "qual_walking_slow"; 
    wait ms 4000;
    start cmd "set-sim-rate";
}

########### Manip ##################
script "run_QUAL_2" {
    start group "0.dev_deputies";
    start group "1.a.core";
    wait ms 100;
    start group "1.b.sensing";
    start cmd "aff_server"; 
    start cmd "GraspController";
    start cmd "Qual2StateMachine";
    start cmd "ReachingPlanner";
    start cmd "sticky_hands";
    wait ms 10000;
    start cmd "qual_manipulation";    
    wait ms 500;  
    start cmd "oracle2coll"; 
}


############ System Test ############
script "core-stop" {
    stop cmd "lcm-logger-no-vis";
    stop cmd "systemwide-test";
    stop group "0.dev_deputies";
    stop group "1.a.core";
    stop group "1.b.sensing";
    stop cmd "Qual1StateMachine";
    stop cmd "FootstepPlanner";
    stop cmd "ZMPWalkingPlanner";
    stop cmd "qual_walking_slow_unpaused";
    stop cmd "set-sim-rate";
}

script "systemtest" {
    start cmd "lcm-logger-no-vis";
    start cmd "systemwide-test";
    wait ms 100;
    run_script "run_QUAL_1";
    wait ms 1200000;
    run_script "core-stop";
    wait ms 10000;
}

script "core-start-vo" {
    run_script "run_QUAL_1";
    stop cmd "estpub";
    start cmd "estpub_sensing";
    start cmd "motion_vo_testing";
}
