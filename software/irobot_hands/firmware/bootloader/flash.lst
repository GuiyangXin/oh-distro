   1               		.file	"flash.c"
   2               	__SREG__ = 0x3f
   3               	__SP_H__ = 0x3e
   4               	__SP_L__ = 0x3d
   5               	__CCP__ = 0x34
   6               	__tmp_reg__ = 0
   7               	__zero_reg__ = 1
   8               		.global __do_copy_data
   9               		.global __do_clear_bss
  11               		.text
  12               	.Ltext0:
 440               		.section	.text.Flash_ProgramPage,"ax",@progbits
 445               	.global	Flash_ProgramPage
 447               	Flash_ProgramPage:
   1:flash.c       **** /************************************************************************/
   2:flash.c       **** /* Generic ATMEL Flash Driver                                           */
   3:flash.c       **** /*                                                                      */
   4:flash.c       **** /* flash.c                                                              */
   5:flash.c       **** /*                                                                      */
   6:flash.c       **** /* Alex Forencich <alex@alexforencich.com>                              */
   7:flash.c       **** /*                                                                      */
   8:flash.c       **** /* Copyright (c) 2011 Alex Forencich                                    */
   9:flash.c       **** /*                                                                      */
  10:flash.c       **** /* Permission is hereby granted, free of charge, to any person          */
  11:flash.c       **** /* obtaining a copy of this software and associated documentation       */
  12:flash.c       **** /* files(the "Software"), to deal in the Software without restriction,  */
  13:flash.c       **** /* including without limitation the rights to use, copy, modify, merge, */
  14:flash.c       **** /* publish, distribute, sublicense, and/or sell copies of the Software, */
  15:flash.c       **** /* and to permit persons to whom the Software is furnished to do so,    */
  16:flash.c       **** /* subject to the following conditions:                                 */
  17:flash.c       **** /*                                                                      */
  18:flash.c       **** /* The above copyright notice and this permission notice shall be       */
  19:flash.c       **** /* included in all copies or substantial portions of the Software.      */
  20:flash.c       **** /*                                                                      */
  21:flash.c       **** /* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,      */
  22:flash.c       **** /* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF   */
  23:flash.c       **** /* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND                */
  24:flash.c       **** /* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS  */
  25:flash.c       **** /* BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN   */
  26:flash.c       **** /* ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN    */
  27:flash.c       **** /* CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE     */
  28:flash.c       **** /* SOFTWARE.                                                            */
  29:flash.c       **** /*                                                                      */
  30:flash.c       **** /************************************************************************/
  31:flash.c       **** 
  32:flash.c       **** #include "flash.h"
  33:flash.c       **** 
  34:flash.c       **** #ifdef __AVR_XMEGA__
  35:flash.c       **** 
  36:flash.c       **** // XMega functions
  37:flash.c       **** // (sp_driver wrapper)
  38:flash.c       **** 
  39:flash.c       **** void Flash_ProgramPage(uint32_t page, uint8_t *buf, uint8_t erase)
  40:flash.c       **** {
 449               	.LM0:
 450               	.LFBB1:
 451 0000 CF92      		push r12
 452 0002 DF92      		push r13
 453 0004 EF92      		push r14
 454 0006 FF92      		push r15
 455 0008 CF93      		push r28
 456 000a DF93      		push r29
 457 000c 0F92      		push __tmp_reg__
 458 000e CDB7      		in r28,__SP_L__
 459 0010 DEB7      		in r29,__SP_H__
 460               	/* prologue: function */
 461               	/* frame size = 1 */
 462               	/* stack size = 7 */
 463               	.L__stack_usage = 7
 464 0012 6B01      		movw r12,r22
 465 0014 7C01      		movw r14,r24
 466 0016 CA01      		movw r24,r20
  41:flash.c       ****         Flash_LoadFlashPage(buf);
 468               	.LM1:
 469 0018 2983      		std Y+1,r18
 470 001a 0E94 0000 		call SP_LoadFlashPage
  42:flash.c       **** 
  43:flash.c       ****         if (erase)
 472               	.LM2:
 473 001e 2981      		ldd r18,Y+1
  44:flash.c       ****         {
  45:flash.c       ****                 Flash_EraseWriteApplicationPage(page);
 475               	.LM3:
 476 0020 C701      		movw r24,r14
 477 0022 B601      		movw r22,r12
  43:flash.c       ****         if (erase)
 479               	.LM4:
 480 0024 2223      		tst r18
 481 0026 01F0      		breq .L2
 483               	.LM5:
 484 0028 0E94 0000 		call SP_EraseWriteApplicationPage
 485 002c 00C0      		rjmp .L3
 486               	.L2:
  46:flash.c       ****         }
  47:flash.c       ****         else
  48:flash.c       ****         {
  49:flash.c       ****                 Flash_WriteApplicationPage(page);
 488               	.LM6:
 489 002e 0E94 0000 		call SP_WriteApplicationPage
 490               	.L3:
  50:flash.c       ****         }
  51:flash.c       **** 
  52:flash.c       ****         Flash_WaitForSPM();
 492               	.LM7:
 493 0032 0E94 0000 		call SP_WaitForSPM
 494               	/* epilogue start */
  53:flash.c       **** }
 496               	.LM8:
 497 0036 0F90      		pop __tmp_reg__
 498 0038 DF91      		pop r29
 499 003a CF91      		pop r28
 500 003c FF90      		pop r15
 501 003e EF90      		pop r14
 502 0040 DF90      		pop r13
 503 0042 CF90      		pop r12
 504 0044 0895      		ret
 506               	.Lscope1:
 507               		.text
 509               	.Letext0:
DEFINED SYMBOLS
                            *ABS*:00000000 flash.c
     /tmp/ccwzFZUo.s:2      *ABS*:0000003f __SREG__
     /tmp/ccwzFZUo.s:3      *ABS*:0000003e __SP_H__
     /tmp/ccwzFZUo.s:4      *ABS*:0000003d __SP_L__
     /tmp/ccwzFZUo.s:5      *ABS*:00000034 __CCP__
     /tmp/ccwzFZUo.s:6      *ABS*:00000000 __tmp_reg__
     /tmp/ccwzFZUo.s:7      *ABS*:00000001 __zero_reg__
     /tmp/ccwzFZUo.s:447    .text.Flash_ProgramPage:00000000 Flash_ProgramPage

UNDEFINED SYMBOLS
__do_copy_data
__do_clear_bss
SP_LoadFlashPage
SP_EraseWriteApplicationPage
SP_WriteApplicationPage
SP_WaitForSPM
