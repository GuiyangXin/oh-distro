<?xml version="1.0"?>
<!-- Changes from sandia_hand.urdf.xacro in  /usr/share/sandia-hand-5.1/ros/sandia_hand_description package -->
<!--
 Custom changes
 ======================================
 1) Changed mesh path package://sandia_hand_description/meshes to  package://mit_drcsim_scripts/models/sandia_hand/meshes

 2) Copied unchanged finger macro to a new thumb macro
 3) Commented out all existing mesh collision elements
 4) Added custom collision and visual elements to links "${side}_f${idx}_2_accel" in thumb macro 
 5) Added custom collision and visual elements to links "${side}_f${idx}_fixed_accel,${side}_f${idx}_1_accel,${side}_f${idx}_2_accel" in finger macro
 6) Commented out finger base Joint "${side}_f${idx}_j0" in finger macro and readded custom Joints for f0,f1 and f2 in the hand macro.
 7) Adding a dummy knuckle link and joint to finger macro.
-->

<robot name="sandia_hand"
       xmlns:xacro="http://www.ros.org/wiki/xacro">

  <xacro:include filename="$(find sandia_hand_description)/urdf/sandia_hand.gazebo.xacro" />
  <xacro:include filename="$(find sandia_hand_description)/urdf/sandia_hand.transmission.xacro" />

  <xacro:macro name="finger" params="idx x y z r p yaw side">
    <link name="${side}_f${idx}_base">
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertial>
        <mass value="0.1"/>
        <origin xyz="0 0 0"/>
        <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
      </inertial>
    </link>
    <link name="${side}_f${idx}_fixed_accel">
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertial>
        <mass value="0.1"/>
        <origin xyz="0 0 0"/>
        <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
      </inertial>
      <!-- ############ MIT ADDITION ############ -->
      <visual>
        <origin rpy="0 0 0" xyz="0 0 0.05"/>
        <geometry>
          <sphere radius="0.005"/>
        </geometry>
      </visual>      
      <collision>
        <origin rpy="0 0 0" xyz="0 0 0.05"/>
        <geometry>
          <sphere radius="0"/>
        </geometry>
      </collision>  
      <!-- ############    END     ############ --> 
    </link>
    <link name="${side}_f${idx}_0">
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertial>
        <mass value="0.1"/>
        <origin xyz="0 0 0"/>
        <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
      </inertial>
      <!-- <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://mit_drcsim_scripts/models/sandia_hand/meshes/f0.stl"/>
        </geometry>
      </collision> -->
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://mit_drcsim_scripts/models/sandia_hand/meshes/f0.stl"/>
        </geometry>
        <material name="${side}_sandia_hand_skin_suntan">
          <color rgba="0.7 0.4 0.2 1.0"/>
        </material>
      </visual>
    </link>
    <link name="${side}_f${idx}_1">
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertial>
        <mass value="0.1"/>
        <origin xyz="0 0 0"/>
        <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
      </inertial>
      <!-- <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://mit_drcsim_scripts/models/sandia_hand/meshes/f1.stl"/>
        </geometry>
      </collision> -->
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://mit_drcsim_scripts/models/sandia_hand/meshes/f1.stl"/>
        </geometry>
        <material name="${side}_sandia_hand_skin">
          <color rgba="0.835 0.655 0.345 1.0"/>
        </material>
      </visual>
    </link>
    <link name="${side}_f${idx}_1_accel">
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertial>
        <mass value="0.1"/>
        <origin xyz="0 0 0"/>
        <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
      </inertial>
      <!-- ############ MIT ADDITION ############ -->
      <visual>
        <origin rpy="0 0 0" xyz="0 0 0.01"/>
        <geometry>
          <sphere radius="0.005"/>
        </geometry>
      </visual>      
      <collision>
        <origin rpy="0 0 0" xyz="0 0 0.01"/>
        <geometry>
          <sphere radius="0"/>
        </geometry>
      </collision>  
      <!-- ############    END     ############ -->   
    </link>
    <link name="${side}_f${idx}_2">
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertial>
        <mass value="0.1"/>
        <origin xyz="0 0 0"/>
        <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
      </inertial>
      <!-- <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://mit_drcsim_scripts/models/sandia_hand/meshes/f2.stl"/>
        </geometry>
      </collision> -->
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://mit_drcsim_scripts/models/sandia_hand/meshes/f2.stl"/>
        </geometry>
        <material name="${side}_sandia_hand_skin_suntan">
          <color rgba="0.8 0.6 0.3 1.0"/>
        </material>
      </visual>
    </link>
    <link name="${side}_f${idx}_2_accel">
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertial>
        <mass value="0.1"/>
        <origin xyz="0 0 0"/>
        <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
      </inertial>
      <!-- ############ MIT ADDITION ############ -->
      <visual>
        <origin rpy="0 0 0" xyz="0 0 0.01"/>
        <geometry>
          <sphere radius="0.005"/>
        </geometry>
      </visual>
      <collision>
        <origin rpy="0 0 0" xyz="0 0 0.01"/>
        <geometry>
          <sphere radius="0"/>
        </geometry>
      </collision>  
      <!-- ############    END     ############ -->        
    </link>

    <joint name="${side}_f${idx}_base" type="fixed">
      <parent link="${side}_palm"/>
      <child link="${side}_f${idx}_base"/>
      <origin xyz="${x} ${y} ${z}" rpy="${r} ${p} ${yaw}"/>
    </joint>
    
<!-- ############ MIT COMMENT OUT ############ -->   
<!--    <joint name="${side}_f${idx}_j0" type="revolute">-->
<!--      <axis xyz="0 0 1"/>-->
<!--      <parent link="${side}_f${idx}_base"/>-->
<!--      <child link="${side}_f${idx}_0"/>-->
<!--      <limit lower="-1.57079" upper="1.57079" effort="1" velocity="1"/>-->
<!--      <safety_controller soft_lower_limit="${-1.57079-10.0}" soft_upper_limit="${1.57079+10.0}" k_position="1000.0" k_velocity="1000.0"/>-->
<!--      <dynamics damping="0.1"/>-->
<!--      <origin xyz="0 0 0" rpy="0 0 0"/>-->
<!--    </joint>-->
<!-- ############    END     ############ -->  
  
    <joint name="${side}_f${idx}_j1" type="revolute">
      <axis xyz="0 0 1"/>
      <parent link="${side}_f${idx}_0"/>
      <child link="${side}_f${idx}_1"/>
      <limit lower="-1.57079" upper="1.57079" effort="1" velocity="1"/>
      <safety_controller soft_lower_limit="${-1.57079-10.0}" soft_upper_limit="${1.57079+10.0}" k_position="1000.0" k_velocity="1000.0"/>
      <dynamics damping="0.1"/>
      <origin xyz="0.028 0 0" rpy="1.57079 0 0"/>
    </joint>
    <joint name="${side}_f${idx}_j2" type="revolute">
      <axis xyz="0 0 1"/>
      <parent link="${side}_f${idx}_1"/>
      <child link="${side}_f${idx}_2"/>
      <origin xyz="0.05 0 0" rpy="0 0 0"/>
      <safety_controller soft_lower_limit="${-1.57079-10.0}" soft_upper_limit="${1.57079+10.0}" k_position="1000.0" k_velocity="1000.0"/>
      <dynamics damping="0.1"/>
      <limit lower="-1.57079" upper="1.57079" effort="1" velocity="1"/>
    </joint>

    <joint name="${side}_f${idx}_fixed_accel" type="fixed">
      <parent link="${side}_f${idx}_base"/>
      <child link="${side}_f${idx}_fixed_accel"/>
      <origin xyz="-0.05 0 0" rpy="0 0 0"/>
    </joint>
    <joint name="${side}_f${idx}_1_accel" type="fixed">
      <parent link="${side}_f${idx}_1"/>
      <child link="${side}_f${idx}_1_accel"/>
      <origin xyz="0.03 0 0" rpy="-1.5709 0 0"/>
    </joint>
    <joint name="${side}_f${idx}_2_accel" type="fixed">
      <parent link="${side}_f${idx}_2"/>
      <child link="${side}_f${idx}_2_accel"/>
      <origin xyz="0.04 0 0" rpy="-1.5709 0 0"/>
    </joint>
    
<!-- ############ MIT ADDITION ############ -->    
   <link name="${side}_f${idx}_knuckle_dummy_contact">
    <origin rpy="0 0 0" xyz="0 0 0"/>
    <inertial>
      <mass value="0.001"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001"/>
    </inertial>
    <visual>
      <origin rpy="0 0 0" xyz="0.058 0 0.034"/>
      <geometry>
        <sphere radius="0.005"/>
      </geometry>
    </visual>    
    <collision>
      <origin rpy="0 0 0" xyz="0.058 0 0.034"/> 
      <geometry>
        <sphere radius="0"/>
      </geometry>
    </collision>
  </link>
   <joint name="${side}_f${idx}_knuckle_dummy_contact" type="fixed">
    <parent link="${side}_f${idx}_base"/>
    <child link="${side}_f${idx}_knuckle_dummy_contact"/>
    <origin rpy="0 0 0" xyz="-0.05 0 0"/>
  </joint>      
<!-- ############    END     ############ --> 
    <xacro:finger_transmission side="${side}" idx="${idx}" x="${x}" y="${y}" z="${z}" r="${r}" p="${p}" yaw="${yaw}"/>
  </xacro:macro>
  
  <xacro:macro name="thumb" params="idx x y z r p yaw side">
    <link name="${side}_f${idx}_base">
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertial>
        <mass value="0.1"/>
        <origin xyz="0 0 0"/>
        <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
      </inertial>
    </link>
    <link name="${side}_f${idx}_fixed_accel">
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertial>
        <mass value="0.1"/>
        <origin xyz="0 0 0"/>
        <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
      </inertial>
    </link>
    <link name="${side}_f${idx}_0">
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertial>
        <mass value="0.1"/>
        <origin xyz="0 0 0"/>
        <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
      </inertial>
      <!-- <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://mit_drcsim_scripts/models/sandia_hand/meshes/f0.stl"/>
        </geometry>
      </collision> -->
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://mit_drcsim_scripts/models/sandia_hand/meshes/f0.stl"/>
        </geometry>
        <material name="${side}_sandia_hand_skin_suntan">
          <color rgba="0.7 0.4 0.2 1.0"/>
        </material>
      </visual>
    </link>
    <link name="${side}_f${idx}_1">
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertial>
        <mass value="0.1"/>
        <origin xyz="0 0 0"/>
        <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
      </inertial>
      <!-- <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://mit_drcsim_scripts/models/sandia_hand/meshes/f1.stl"/>
        </geometry>
      </collision> -->
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://mit_drcsim_scripts/models/sandia_hand/meshes/f1.stl"/>
        </geometry>
        <material name="${side}_sandia_hand_skin">
          <color rgba="0.835 0.655 0.345 1.0"/>
        </material>
      </visual>
    </link>
    <link name="${side}_f${idx}_1_accel">
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertial>
        <mass value="0.1"/>
        <origin xyz="0 0 0"/>
        <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
      </inertial>
    </link>
    <link name="${side}_f${idx}_2">
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertial>
        <mass value="0.1"/>
        <origin xyz="0 0 0"/>
        <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
      </inertial>
      <!-- <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://mit_drcsim_scripts/models/sandia_hand/meshes/f2.stl"/>
        </geometry>
      </collision> -->
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://mit_drcsim_scripts/models/sandia_hand/meshes/f2.stl"/>
        </geometry>
        <material name="${side}_sandia_hand_skin_suntan">
          <color rgba="0.8 0.6 0.3 1.0"/>
        </material>
      </visual>
    </link>
    <link name="${side}_f${idx}_2_accel">
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertial>
        <mass value="0.1"/>
        <origin xyz="0 0 0"/>
        <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
      </inertial>
      <!-- ############ MIT ADDITION ############ -->
      <visual>
        <origin rpy="0 0 0" xyz="0 0 0.01"/>
        <geometry>
          <sphere radius="0.005"/>
        </geometry>
      </visual>      
      <collision>
        <origin rpy="0 0 0" xyz="0 0 0.01"/>
        <geometry>
          <sphere radius="0"/>
        </geometry>
      </collision> 
      <!-- ############    END     ############ -->    
    </link>

    <joint name="${side}_f${idx}_base" type="fixed">
      <parent link="${side}_palm"/>
      <child link="${side}_f${idx}_base"/>
      <origin xyz="${x} ${y} ${z}" rpy="${r} ${p} ${yaw}"/>
    </joint>
    <joint name="${side}_f${idx}_j0" type="revolute">
      <axis xyz="0 0 1"/>
      <parent link="${side}_f${idx}_base"/>
      <child link="${side}_f${idx}_0"/>
      <limit lower="-1.57079" upper="1.57079" effort="1" velocity="1"/>
      <safety_controller soft_lower_limit="${-1.57079-10.0}" soft_upper_limit="${1.57079+10.0}" k_position="1000.0" k_velocity="1000.0"/>
      <dynamics damping="0.1"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
    </joint>
    <joint name="${side}_f${idx}_j1" type="revolute">
      <axis xyz="0 0 1"/>
      <parent link="${side}_f${idx}_0"/>
      <child link="${side}_f${idx}_1"/>
      <limit lower="-1.57079" upper="1.57079" effort="1" velocity="1"/>
      <safety_controller soft_lower_limit="${-1.57079-10.0}" soft_upper_limit="${1.57079+10.0}" k_position="1000.0" k_velocity="1000.0"/>
      <dynamics damping="0.1"/>
      <origin xyz="0.028 0 0" rpy="1.57079 0 0"/>
    </joint>
    <joint name="${side}_f${idx}_j2" type="revolute">
      <axis xyz="0 0 1"/>
      <parent link="${side}_f${idx}_1"/>
      <child link="${side}_f${idx}_2"/>
      <origin xyz="0.05 0 0" rpy="0 0 0"/>
      <safety_controller soft_lower_limit="${-1.57079-10.0}" soft_upper_limit="${1.57079+10.0}" k_position="1000.0" k_velocity="1000.0"/>
      <dynamics damping="0.1"/>
      <limit lower="-1.57079" upper="1.57079" effort="1" velocity="1"/>
    </joint>

    <joint name="${side}_f${idx}_fixed_accel" type="fixed">
      <parent link="${side}_f${idx}_base"/>
      <child link="${side}_f${idx}_fixed_accel"/>
      <origin xyz="-0.05 0 0" rpy="0 0 0"/>
    </joint>
    <joint name="${side}_f${idx}_1_accel" type="fixed">
      <parent link="${side}_f${idx}_1"/>
      <child link="${side}_f${idx}_1_accel"/>
      <origin xyz="0.03 0 0" rpy="-1.5709 0 0"/>
    </joint>
    <joint name="${side}_f${idx}_2_accel" type="fixed">
      <parent link="${side}_f${idx}_2"/>
      <child link="${side}_f${idx}_2_accel"/>
      <origin xyz="0.04 0 0" rpy="-1.5709 0 0"/>
    </joint>

    <xacro:finger_transmission side="${side}" idx="${idx}" x="${x}" y="${y}" z="${z}" r="${r}" p="${p}" yaw="${yaw}"/>
  </xacro:macro>
  

  <xacro:macro name="sandia_hand" params="side parent *origin">
    <link name="${side}_palm">
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertial>
        <mass value="0.1"/>
        <origin xyz="0 0 0"/>
        <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/>
      </inertial>
      <!-- <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://mit_drcsim_scripts/models/sandia_hand/meshes/palm.stl"/>
        </geometry>
      </collision> -->
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://mit_drcsim_scripts/models/sandia_hand/meshes/palm.stl"/>
        </geometry>
        <material name="${side}_sandia_hand_skin">
          <color rgba="0.835 0.655 0.345 1.0"/>
        </material>
      </visual>
    </link>

    <joint name="${side}_sandia_hand_joint" type="fixed">
      <parent link="${parent}"/>
      <child link="${side}_palm"/>
      <insert_block name="origin" />
    </joint>

    <xacro:finger side="${side}" idx="0" x="0.140" y="0.00000" z="0" r="0" p="0" yaw="0.3"/>
    <xacro:finger side="${side}" idx="1" x="0.115" y="0.03122" z="0" r="0" p="0" yaw="0.3"/>
    <xacro:finger side="${side}" idx="2" x="0.090" y="0.06245" z="0" r="0" p="0" yaw="0.3"/>
    <xacro:thumb side="${side}" idx="3" x="0.03995" y="-0.04383" z="0.014" r="0" p="-1.57079" yaw="-2.3562"/>
    
 <!-- ############ MIT ADDITION ############ -->   
 <!-- custom finger joint limits for base joint of fingers -->
  <joint name="${side}_f0_j0" type="revolute">
    <axis xyz="0 0 1"/>
    <parent link="${side}_f0_base"/>
    <child link="${side}_f0_0"/>
    <!--    <limit effort="1" lower="-1.57079" upper="1.57079" velocity="1"/>-->
    <limit effort="1" lower="-1.57079" upper="0" velocity="1"/>
    <safety_controller k_position="1000.0" k_velocity="1000.0" soft_lower_limit="-11.57079" soft_upper_limit="11.57079"/>
    <dynamics damping="0.1"/>
    <origin rpy="0 0 0" xyz="0 0 0"/>
  </joint>
  <joint name="${side}_f1_j0" type="revolute">
    <axis xyz="0 0 1"/>
    <parent link="${side}_f1_base"/>
    <child link="${side}_f1_0"/>
    <!--    <limit effort="1" lower="-1.57079" upper="1.57079" velocity="1"/>-->
    <limit effort="1" lower="-0.09" upper="0.09" velocity="1"/>
    <safety_controller k_position="1000.0" k_velocity="1000.0" soft_lower_limit="-11.57079" soft_upper_limit="11.57079"/>
    <dynamics damping="0.1"/>
    <origin rpy="0 0 0" xyz="0 0 0"/>
  </joint>  
  <joint name="${side}_f2_j0" type="revolute">
    <axis xyz="0 0 1"/>
    <parent link="${side}_f2_base"/>
    <child link="${side}_f2_0"/>
    <!--    <limit effort="1" lower="-1.57079" upper="1.57079" velocity="1"/>-->
    <limit effort="1" lower="0" upper="1.57079" velocity="1"/>
    <safety_controller k_position="1000.0" k_velocity="1000.0" soft_lower_limit="-11.57079" soft_upper_limit="11.57079"/>
    <dynamics damping="0.1"/>
    <origin rpy="0 0 0" xyz="0 0 0"/>
  </joint>  
<!-- ############    END     ############ -->  


    <!-- not needed unless simulating the hand by itself
    <xacro:sandia_hand_gazebo side="${side}" />
    -->

  </xacro:macro>
</robot>

